{% extends "%s/2019/base.html" % lang %}

{% block image_url %}https://almanac.httparchive.org/static/images/home-hero-bg.png{% endblock %}
{% block image_height %}562{% endblock %}
{% block image_width %}715{% endblock %}

{% block breadcrumb %}
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
      "@type": "ListItem",
      "position": 1,
      "name": "{{ lang }}",
      "item": "https://almanac.httparchive.org/{{lang}}/"
    }]
  }
</script>
{% endblock %}

{% block styles %}
  {{ super() }}
  <link rel="stylesheet" href="/static/css/index.css?v=20200707100400">
{% endblock %}

{% block main %}
<main id="maincontent">
  <section id="intro" class="intro-container">
    <div class="intro">
      <div class="intro-year">{{ year }}</div>
      <h1 class="title title-lg title-alt">{{ self.intro_title() }}</h1>
      <h2>{{ self.intro_sub_title() }}</h2>
      <p>{{ self.mission() }}</p>
      <a href="{{ url_for('table_of_contents', year=year, lang=lang) }}" class="btn">
        {{ self.start_exploring() }}
      </a>
    </div>
    <div class="intro-image-wrapper">
      <svg viewBox="0 0 50 16">
        <text x="7" y="15">{{ year }}</text>
      </svg>      
      <img src="/static/images/home-hero.png" alt="" width="562" height="820">
    </div>
  </section>
  {% if featured_quotes %}
  {# Get a random quote server side for those without JS #}
  {%- set random_chapter = featured_quotes.keys()|list()|random %}
  {%- set featured_chapter_quotes = featured_quotes.get(random_chapter) %}
  {% if featured_chapter_quotes %}
  <script nonce="{{ csp_nonce() }}">
    // Get a random quote using JS for those reloading cached CDN page
    // We do as much as possible before HTML so we can replace the quote
    // without a flash of the server side quote
    var chapter_names = {{ localizedChapterTitles|tojson }}
    var featured_chapters = {{ featured_quotes|tojson }}
    const keys = Object.keys(featured_chapters)
    const randIndex = Math.floor(Math.random() * keys.length)
    const randKey = keys[randIndex];
  </script>
  <section id="featured-chapter" class="featured-chapter">
    <div class="featured-chapter-content">
      <h2 class="title title-center">Featured Chapter</h2>
      <h3 class="featured-chapter-name">{{ localizedChapterTitles[random_chapter] }}</h3>
      <blockquote id="featured-quote">
        {{ featured_chapter_quotes.get('quote') }}
      </blockquote>
      <div class="featured-chapter-content-data">
        {% if featured_chapter_quotes.get('stat1') %}
        <div class="featured-chapter-content-data-item">
        {% else %}
        <div class="featured-chapter-content-data-item" hidden>
        {% endif %}>
          <div id="featured-stat-1">
            {{ featured_chapter_quotes.get('stat1') }}
          </div>
          <div id="featured-stat-label-1">{{ featured_chapter_quotes.get('label1')|safe }}</div>
        </div>
        {% if featured_chapter_quotes.get('stat2') %}
        <div class="featured-chapter-content-data-item">
        {% else %}
        <div class="featured-chapter-content-data-item" hidden>
        {% endif %}>
          <div id="featured-stat-2">
            {{ featured_chapter_quotes.get('stat2') }}
          </div>
          <div id="featured-stat-label-2">{{ featured_chapter_quotes.get('label2')|safe }}</div>
        </div>
        {% if featured_chapter_quotes.get('stat3') %}
        <div class="featured-chapter-content-data-item">
        {% else %}
        <div class="featured-chapter-content-data-item" hidden>
        {% endif %}>
          <div id="featured-stat-3">
            {{ featured_chapter_quotes.get('stat3') }}
          </div>
          <div id="featured-stat-label-3">
            {{ featured_chapter_quotes.get('label3') }}
          </div>
        </div>
      </div>
      <a href="{{ url_for('chapter', year=year, chapter=featured_chapter, lang=lang) }}" class="btn">
        Read the <span class="featured-chapter-name">{{ featured_chapter_name }}</span> Chapter
      </a>
    </div>
  </section>
  {% endif %}
  <script nonce="{{ csp_nonce() }"}>

    // Replace the server-side generated random quote with JS-generated one
    // so you get a new quote each time you come, even if page is cached:
    var featured_quote = document.querySelector('#featured-quote');
    if (featured_quote) {
      featured_quote.innerHTML = featured_chapters[randKey].quote;
    }

    var featured_titles = document.querySelectorAll('.featured-chapter-name');
    for (var i = 0; i < featured_titles.length; i++) {
      featured_titles[i].innerHTML = chapter_names[randKey];
    }

    for (let i=1; i <= 3; i++) {
      var stat = featured_chapters[randKey]['stat_' + i];
      var stat_label = featured_chapters[randKey]['stat_label_' + i];
      var stat_node = document.querySelector('#featured-stat-' + i);
      var stat_label_node = document.querySelector('#featured-stat-label-' + i);
      if (stat_node && stat_label_node) {
        if (stat && stat_label) {
          stat_node.innerHTML = stat;
          stat_label_node.innerHTML = stat_label;
          stat_node.hidden = false;
          stat_label_node.hidden = false;
        } else {
          stat_node.hidden = true;
          stat_label_node.hidden = true;
        }
      }
    }
  </script>
  {% endif %}
  <section id="contributors" class="contributors-container alt-bg">
    <div class="contributors">
      <h2 class="title title-alt">{{ self.contributors_title() }}</h2>
      <p>{{ self.contributors_description() }}</p>
      <a href="{{ url_for('contributors', year=year, lang=lang) }}" class="alt btn">
        {{ self.contributors_link() }}
      </a>
    </div>
    <div class="people" aria-hidden="true">
      <div class="people-number">{{ self.contributors() }}</div>
      <img id="character-markup" class="character" src="/static/images/character-markup.png" alt="" width="154" height="252" loading="lazy" />
      <img id="character-star" class="character" src="/static/images/character-star.png" alt="" width="245" height="254" loading="lazy" />
      <img id="character-hat" class="character" src="/static/images/character-hat.png" alt="" width="186" height="207" loading="lazy" />
    </div>
  </section>
  <section id="methodology" class="methodology-container">
    <div class="methodology">
      <h2 class="title title-center">{{ self.methodology_title() }}</h2>
      <div class="methodology-data">
        <div class="websites-tested">
          <div>
            {{ self.methodology_stat_1_title() }}
          </div>
          <div>
            {{ self.methodology_stat_1() }}
          </div>
        </div>
        <div class="data-processed">
          <div>
            {{ self.methodology_stat_2_title() }}
          </div>
          <div>
            {{ self.methodology_stat_2() }}
          </div>
        </div>
      </div>
      <p class="methodology-info">
        {{ self.methodology_description() }}
      </p>
      <a href="{{ url_for('methodology', year=year, lang=lang) }}" class="alt btn">
        {{ self.methodology_link() }}
      </a>
      <img class="methodology-characters" src="/static/images/methodology-characters.png" alt="" width="984" height="354" loading="lazy" />
    </div>
  </section>
</main>
{% endblock %}
